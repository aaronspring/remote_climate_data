plugins:
  source:
    - module: intake_xarray
sources:
  GISTEMP:
    description: GISS Surface Temperature Analysis (GISTEMP v4)
    metadata:
      url: https://data.giss.nasa.gov/gistemp/
      doi: 10.1029/2018JD029522
    driver: netcdf
    args:
      urlpath: simplecache::https://data.giss.nasa.gov/pub/gistemp/gistemp1200_GHCNv4_ERSSTv5.nc.gz
      storage_options:
        simplecache:
          same_names: True
      chunks: {'time':'auto'}

  HadISST1:
    description: Hadley Centre Sea Ice and Sea Surface Temperature data set 1
    metadata:
      url: https://www.metoffice.gov.uk/hadobs/hadisst/
      doi: 10.1029/2002JD002670
    driver: netcdf
    args:
      urlpath: simplecache::https://www.metoffice.gov.uk/hadobs/hadisst/data/HadISST_sst.nc.gz
      chunks: {'time': 'auto'}
      storage_options:
        simplecache:
          same_names: True

  HadSST4:
    description: Met Office Hadley Centre's sea surface temperature data set 4
    metadata:
      url: https://www.metoffice.gov.uk/hadobs/hadsst4/
      doi:
    driver: netcdf
    parameters:
      file:
        description: name of file
        type: str
        default: median
        allowed: [median, total_incertainty, measurement_and_sampling_uncertainty, uncorrelated_measurement_uncertainty, correlated_measurement_uncertainty, number_of_observations, number_of_superobservations, unadjusted, actuals_median, actuals_ensemble]
    args:
      urlpath: simplecache::https://www.metoffice.gov.uk/hadobs/hadsst4/data/netcdf/HadSST.4.0.0.0_{{file}}.nc
      chunks: {'time': 'auto'}
      storage_options:
        simplecache:
          same_names: True

  CSIR-ML6:
    description: CSIR
    metadata:
      url: https://figshare.com/articles/Global_surface_ocean_pCO2_from_CSIR-ML6_2020a_/12652100/4
      doi:
        - 10.5194/gmd-12-5113-2019
        - 10.6084/m9.figshare.12652100.v4
    driver: netcdf
    args:
      urlpath: simplecache::https://ndownloader.figshare.com/files/23875943
      chunks: {'time':'auto'}
      storage_options:
        simplecache:
          same_names: True

  SOM_FFN:
    description: Observational time series data
    driver: netcdf
    metadata:
      url: https://www.nodc.noaa.gov/ocads/oceans/SPCO2_1982_present_ETH_SOM_FFN.html
      doi:
        - 10.1002/2015GB005359
        - 10.7289/V5Z899N6
      plots:
        fgco2_over_time:
          title: SOM-FFN fgco2 over time
          kind: contourf
          x: lon
          y: lat
          z: fgco2_smoothed
          groupby: time
          cmap: RdBu_r
          levels: 20
          # clim: (-10, 10)  # once https://github.com/holoviz/hvplot/pull/492 is merged
        fgco2_timeseries_location:
          title: fgco2 timeseries at (lon,lat) location
          kind: line
          x: time
          y: fgco2_smoothed
          groupby: ['lon','lat']
        fgco2_timeseries_latitude:
          title: fgco2 timeseries at latitude
          kind: contourf
          y: time
          x: lon
          z: fgco2_smoothed
          groupby: lat
          levels: 20
    parameters:
      version:
        description: version release in year
        type: int
        default: 2020
        allowed: [2017,2018,2020]
    args:
      urlpath: simplecache::https://data.nodc.noaa.gov/ncei/ocads/data/0160558/MPI_SOM-FFN_v{{version}}/spco2_MPI-SOM_FFN_v{{version}}.nc
      chunks: {'time':'120'}
      storage_options:
        simplecache:
          same_names: True
      xarray_kwargs:
        drop_variables: date

  WOA2018:
    description: World Ocean Atlas 2018
    driver: opendap
    metadata:
      url: https://www.nodc.noaa.gov/cgi-bin/OC5/woa18/woa18.pl
      doi: not found
    parameters:
      variable:
        description: version release in year
        type: str
        default: temperature
        allowed: [temperature, salinity, oxygen, phosphate, nitrate, AOU] # silicate(i), o2sat(O) overlapping first string
      DDDD:
        description: decade
        type: str
        default: decav
        # average, 1955-1964, 1965-1974, 1975-1984, 1985-1994, 1995-2004, 2005-2017, 1981-2010
        allowed: [decav, 5564, 6574, 7584, 8594, 95A4, A5B7, 81B0]
      TT:
        description: time period
        type: int
        default: '00'
        # annual: 0 , J: 1, F: 2 ... winter:13, spring:14, summer:15, autumn:16
        min: 0
        max: 16
      GG:
        description: grid
        type: str
        default: '1.00'
        #     [GG] - grid (5deg- 5°, 01- 1°, 04 - 1/4°)
        allowed: ['5.00', '1.00', '0.25']
      GG2:
        description: matching grid GG # inconsistency in WOA2018 file naming
        type: str
        default: '01'
        allowed: ['5d', '01', '04']
    args:
      urlpath: https://data.nodc.noaa.gov/thredds/dodsC/ncei/woa/{{variable}}/{{DDDD}}/{{GG}}/woa18_{{DDDD}}_{{variable[0]}}{{ "%02d" | format(TT) }}_{{GG2}}.nc
      xarray_kwargs:
        decode_times: false

  OISSTv21:
    driver: netcdf
    description: "Optimum Interpolation Sea Surface Temperature (OISST) v2.1 provided by the NOAA/NCEI from their Web site at https://www.ncdc.noaa.gov/oisst/data-access"
    metadata:
      url: https://www.ncdc.noaa.gov/oisst/optimum-interpolation-sea-surface-temperature-oisst-v21
      doi: 10.1175/JTECH-D-19-0177.1
    parameters:
      date:
        description: time
        type: datetime
        default: 1982.01.01
        min: 1981.09.01
    args:
      urlpath: simplecache::https://www.ncei.noaa.gov/data/sea-surface-temperature-optimum-interpolation/v2.1/access/avhrr/{{date.strftime("%Y%m")}}/oisst-avhrr-v02r01.{{date.strftime("%Y%m%d")}}.nc
      storage_options:
        simplecache:
          same_names: true
      chunks: {}

  OISSTv2:
    driver: netcdf
    description: "Optimum Interpolation Sea Surface Temperature (OISST) v2.0 provided by the NOAA/NCEI from their Web site at https://www.ncdc.noaa.gov/oisst/data-access"
    metadata:
      url: https://www.ncdc.noaa.gov/oisst/optimum-interpolation-sea-surface-temperature-oisst-v20
      doi: 10.1175/JTECH-D-19-0177.1
    parameters:
      date:
        description: time
        type: datetime
        default: 2005.01.01
        min: 1981.09.01 # 2002.06.01 amsr-avhrr
        max: 2020.04.01 # avhrr-only # 2011.10.04 amsr-avhrr
      kind:
        description: There are two kinds of daily OISST, named after the relevant satellite SST sensors. These are the Advanced Very High Resolution Radiometer (AVHRR) and Advanced Microwave Scanning Radiometer on the Earth Observing System (AMSR-E). AVHRR has the longest record (from late 1981 to the present) of SST measurements from a single sensor design. Infrared instruments, like AVHRR, can make observations at relatively high resolution but cannot see through clouds. Microwave instruments like AMSR-E can measure SSTs in most weather conditions (except heavy rain) but not adjacent to land.
        type: str
        default: avhrr-only
        allowed: [avhrr-only, amsr-avhrr]
    args:
      urlpath: simplecache::https://www.ncei.noaa.gov/data/sea-surface-temperature-optimum-interpolation/v2/access/{{kind}}/{{date.strftime("%Y%m")}}/{{kind}}-v2.{{date.strftime("%Y%m%d")}}.nc
      storage_options:
        simplecache:
          same_names: true
      chunks: {}

  OISSTv2_thredds
    description: "Optimum Interpolation Sea Surface Temperature (OISST) v2.0 via psl.noaa.gov/thredds"
    metadata:
      url: https://www.ncdc.noaa.gov/oisst/optimum-interpolation-sea-surface-temperature-oisst-v20
      doi: 10.1175/JTECH-D-19-0177.1
    driver: intake_thredds.source.THREDDSMergedSource
    parameters:
      year:
        description: year
        type: str
        default: '*'  # merges all years
      var:
        description: variable
        type: str
        default: sst
        allowed: [sst, icec]
    args:
      path:
      - "{{var}}.day.mean.{{year}}.v2.nc"
      url: https://psl.noaa.gov/thredds/catalog/Datasets/noaa.oisst.v2.highres/catalog.xml
