---
plugins:
  source:
    - module: intake_geopandas

sources:
  Countries:
    description: Natural Earth Data Admin 0 Countries
    metadata:
      url: https://www.naturalearthdata.com/downloads/10m-cultural-vectors/10m-admin-0-countries/
    driver: intake_geopandas.geopandas.ShapefileSource
    args:
      urlpath: simplecache::https://www.naturalearthdata.com/http//www.naturalearthdata.com/download/10m/cultural/ne_10m_admin_0_countries.zip
      use_fsspec: true
      storage_options:
        simplecache:
          same_names: true

  IPCCAR6:
    description: IPCC regions AR6 reference regions - Iturbide et al., 2020
    metadata:
      doi: https://doi.org/10.5194/essd-12-2959-2020
    driver: intake_geopandas.geopandas.ShapefileSource
    args:
      urlpath: simplecache::https://github.com/regionmask/regionmask/raw/main/data/IPCC-WGI-reference-regions-v4.zip
      use_fsspec: true
      storage_options:
        simplecache:
          same_names: true

  geometric_features:
    description: MPAS geometric features
    metadata:
      url: https://github.com/MPAS-Dev/geometric_features
    parameters:
      region:
        description: region
        type: str
        default: Baltic_Sea
      realm:
        description: realm
        type: str
        default: ocean
        allowed:
          - bedmachine
          - bedmap2
          - iceshelves
          - landice
          - ocean
      type:
        description: type
        type: str
        default: region
        allowed:
          - region
          - transect  # transect only in ocean
    driver: intake_geopandas.geopandas.GeoJSONSource
    args:
      urlpath: simplecache::https://raw.githubusercontent.com/MPAS-Dev/geometric_features/master/geometric_data/{{realm}}/{{type}}/{{region}}/{{type}}.geojson
      use_fsspec: true
      storage_options:
        simplecache:
          same_names: true

  GeigerKoeppen_shp:
    description: >-
      Köppen-Geiger climate classification shapefile

      Note: combine all areas of a certain region by `dissolve("GRID")`
    metadata:
      url: http://koeppen-geiger.vu-wien.ac.at/
      doi: http://dx.doi.org/10.1127/0941-2948/2006/0130
    driver: intake_geopandas.geopandas.ShapefileSource
    parameters:
      period:
        description: period start-end
        type: str
        default: "1976-2000"
        allowed:
          - "1901-1925"
          - "1926-1950"
          - "1951-1975"
          - "1976-2000"  # observed
          - "2001-2025_A1FI"  # future scenario A1FI
          - "2001-2025_A2"
          - "2001-2025_B1"
          - "2001-2025_B2"
          - "2026-2050_A1FI"
          - "2026-2050_A2"
          - "2026-2050_B1"
          - "2026-2050_B2"
          - "2051-2075_A1FI"
          - "2051-2075_A2"
          - "2051-2075_B1"
          - "2051-2075_B2"
          - "2076-2100_A1FI"
          - "2076-2100_A2"
          - "2076-2100_B1"
          - "2076-2100_B2"
    args:
      urlpath: simplecache::http://koeppen-geiger.vu-wien.ac.at/data/{{period}}_GIS.zip
      use_fsspec: true
      storage_options:
        simplecache:
          same_names: true

  GeigerKoeppen_xr:
    description: >-
      Köppen-Geiger climate classification xarray.DataArray

      Note:
          Use `transform_kwargs` to be passed to the transform function.
          Use `target_kwargs: target` to be passed to the target.
          See https://github.com/intake/intake/issues/638
          ```python
          cat.shapefiles.GeigerKoeppen_xr(
            transform_kwargs=dict(res=5),
            target_kwargs=dict(GeigerKoeppen_shp=dict(period="1976-2000"))
          ).read().plot()
          ```

    metadata:
      url: http://koeppen-geiger.vu-wien.ac.at/
      doi: http://dx.doi.org/10.1127/0941-2948/2006/0130
    driver: intake.source.derived.GenericTransform
    args:
      targets:
        - GeigerKoeppen_shp
      transform: "remote_climate_data.utils.geigerkoeppen.dissolve_to_xrDataArray"
      transform_kwargs: {res: 1}
